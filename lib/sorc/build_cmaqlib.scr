#!/bin/bash -x
module purge
module load PrgEnv-intel
module load cray-netcdf/4.3.2
module load cray-hdf5/1.8.13
export IOAPI_OFFSET_64=YES
export NETCDF_LDFLAGS="-L$NETCDF_DIR/lib -lnetcdff -lnetcdf -L$HDF5_DIR/lib -lhdf5_fortran -lhdf5_hl -lhdf5 -lz"

cd aqm_ioapi_v32
make all

if [ ! -s Linux2_x86_64ifort/libioapi.a ]; then
 echo "make failed"
 exit 1
fi 

cp -p Linux2_x86_64ifort/libioapi.a ../../libaqm_ioapi.a
cp -p Linux2_x86_64ifort/*.mod ../../include
cp -p ioapi/*.EXT ../../include 
